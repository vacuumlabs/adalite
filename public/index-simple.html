<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Example page with loaded cardano js bundle</title>

</head>

<body>
<script src="js/cardano.bundle.js"></script>
<!--<script src="./example.usage.js"></script>-->

<script language="javascript">
    let wallet = null;
    let historyRaw = null;

    function printMnemonic() {
      document.getElementById("mnemonic-generated").innerHTML = Cardano.generateMnemonic();
    }

    async function submitMnemonic() {
      const words = document.getElementById("mnemonic-submitted").value;
      wallet = Cardano.CardanoWallet(words);
      await updateWallet();
    }

    async function submitSecret() {
      const secret = document.getElementById("secret-submitted").value;
      wallet = Cardano.CardanoWallet(secret);
      await updateWallet();
    }

    async function updateWallet() {
      document.getElementById("wallet-balance").innerHTML = "processing ..";
      document.getElementById("wallet-balance").innerHTML = await wallet.getBalance();
    }
    async function getAddress() {
      document.getElementById("receive-address").innerHTML = "processing ..";
      document.getElementById("receive-address").innerHTML = await wallet.getChangeAddress();
    }
    async function calculateFee() {
      document.getElementById("fee").innerHTML = "processing ..";
      const address = document.getElementById("send-address").value;
      const amount = parseInt(document.getElementById("send-amount").value, 10);
      document.getElementById("fee").innerHTML = await wallet.getTxFee(address, amount);
    }
    async function submitTransaction() {
      document.getElementById("transacton-submitted").innerHTML = "processing ..";
      const address = document.getElementById("send-address").value;
      const amount = parseInt(document.getElementById("send-amount").value, 10);
      document.getElementById("transacton-submitted").innerHTML = await wallet.sendAda(address, amount);
      await updateWallet();
    }
    async function updateHistory() {
      document.getElementById("history").innerHTML = "processing ..";
      historyRaw = await wallet.getHistory();
      window.h = historyRaw

      histtable =
      "<div style='display: flex; flex-direction:column'>"
      for (const transaction of historyRaw) {
        histtable +=
        `<div id='${transaction.ctbId}' onclick='expandTransaction(this)' style='cursor: pointer; display: flex; flex-direction: row; justify-content:space-around; flex-wrap: wrap;'>
             <div>${transaction.ctbTimeIssued}</div>
             <div>${transaction.ctbId}</div>
             <div>${transaction.effect}</div>
             <div class="detail" style='width: 100%; background-color: #999999; display: none'>`
      histtable += "<div style='display: flex; flex-direction: row; justify-content:space-around;'>"

      histtable += "<div style='display: flex; flex-direction: column;'>"
      for (const input of transaction.ctbInputs) {
        histtable += "<div style='display: flex; flex-direction: row; justify-content:space-between;'>"
        histtable += `  <div style="width: 250px; overflow: hidden;text-overflow: ellipsis;">${input[0]}</div><div>${input[1].getCoin}</div>`
        histtable += `</div>`
      }
      histtable += `</div>`
      histtable += `<div>=></div>`
      histtable += "<div style='display: flex; flex-direction: column;'>"
      for (const output of transaction.ctbOutputs) {
        histtable += "<div style='display: flex; flex-direction: row; justify-content:space-between;'>"
        histtable += `  <div style="width: 250px; overflow: hidden;text-overflow: ellipsis;">${output[0]}</div><div>${output[1].getCoin}</div>`
        histtable += `</div>`
      }
      histtable += `</div>`


      histtable += `</div></div></div>`
    }
    histtable += "</div>";
      document.getElementById("history").innerHTML = histtable;
    }

  function expandTransaction(parent) {
    if (!!parent.getAttribute("detail")) {
      parent.setAttribute("detail", "");
      parent.getElementsByClassName("detail")[0].style.display = "none";
    } else {
      parent.setAttribute("detail", true);
      parent.getElementsByClassName("detail")[0].style.display = "block";
    }
  }

</script>


<p>
    <button onclick="printMnemonic()">Generate mnemonic</button>
    <span id="mnemonic-generated"></span>
</p>
<p>
    Mnemonic: <input type="text" id="mnemonic-submitted" name="mnemonic-submitted" size="47" value="cruise bike bar reopen mimic title style fence race solar million clean">
    <button onclick="submitMnemonic()">Wallet from mnemonic</button>
</p>
<p>
    secretKey: <input type="text" id="secret-submitted" name="secret-submitted" size="64" value="A859BCAD5DE4FD8DF3F3BFA24793DBA52785F9A98832300844F028FF2DD75A5FCD24F7E51D3A2A72AC85CC163759B1103EFB1D685308DCC6CD2CCE09F70C948501E949B5B7A72F1AD304F47D842733B3481F2F096CA7DDFE8E1B7C20A1ACAFBB66EE772671D4FEF6418F670E80AD44D1747A89D75A4AD386452AB5DC1ACC32B3">
    <button onclick="submitSecret()">Wallet from secret</button>
</p>
<p>
    <p>Wallet balance: <span id="wallet-balance" style="background-color: #4dc71f"></span> Lovelace (1 Lovelace = 1/1,000,000 Ada)
    <button onclick="updateWallet()">Refresh</button></p>
</p>
<p>
    <button onclick="getAddress()">Get address to receive Ada</button>
    <span id="receive-address" style="background-color: #aff520"></span>
</p>

<p>
    <h3>send Ada:</h3>
    address: <input type="text" id="send-address" name="send-address" size="110" value="DdzFFzCqrhsoNpMFaQfYFHiuKN5NjNWtypJcKpWsNJX6miADvKxhZxyeDyNkfnBDxswNnGpLCuB6MkNy7uhD4eu4jgMgFkBgySiPegkY"></br>
    amount: <input type="number" id="send-amount" name="send-amount" size="8" value="185000"> Lovelace (1 Lovelace = 1/1,000,000 Ada)</br>
    Fee: <span id="fee" style="background-color: aquamarine"></span> Lovelace (1 Lovelace = 1/1,000,000 Ada)
    <button onclick="calculateFee()">Calculate fee</button></br>
    <button onclick="submitTransaction()">Send Ada</button><span id="transacton-submitted" style="background-color: #ffc520"></span>
</p>

<p>
    <h3>history:</h3>
    <p id="history"></p>>
    <button onclick="updateHistory()">Update history</button>
</p>

</body>

</html>
